define(["durandal/system","durandal/binder","knockout"],function(e,t,n){function a(e){var t=e[0];return"_"===t||"$"===t}function i(t){return!(!t||void 0===t.nodeType||!e.isNumber(t.nodeType))}function r(e){if(!e||i(e)||e.ko===n||e.jquery)return!1;var t=f.call(e);return-1==v.indexOf(t)&&!(e===!0||e===!1)}function o(e,t){var n=e.__observable__,a=!0;if(!n||!n.__full__){n=n||(e.__observable__={}),n.__full__=!0,g.forEach(function(n){e[n]=function(){a=!1;var e=b[n].apply(t,arguments);return a=!0,e}}),p.forEach(function(n){e[n]=function(){a&&t.valueWillMutate();var i=m[n].apply(e,arguments);return a&&t.valueHasMutated(),i}}),h.forEach(function(n){e[n]=function(){for(var i=0,r=arguments.length;r>i;i++)s(arguments[i]);a&&t.valueWillMutate();var o=m[n].apply(e,arguments);return a&&t.valueHasMutated(),o}}),e.splice=function(){for(var n=2,i=arguments.length;i>n;n++)s(arguments[n]);a&&t.valueWillMutate();var r=m.splice.apply(e,arguments);return a&&t.valueHasMutated(),r};for(var i=0,r=e.length;r>i;i++)s(e[i])}}function s(t){var i,s;if(r(t)&&(i=t.__observable__,!i||!i.__full__)){if(i=i||(t.__observable__={}),i.__full__=!0,e.isArray(t)){var c=n.observableArray(t);o(t,c)}else for(var u in t)a(u)||i[u]||(s=t[u],e.isFunction(s)||l(t,u,s));y&&e.log("Converted",t)}}function c(e,t,n){var a;e(t),a=e.peek(),n?a?a.destroyAll||o(a,e):(a=[],e(a),o(a,e)):s(a)}function l(t,a,i){var r,l,u=t.__observable__||(t.__observable__={});if(void 0===i&&(i=t[a]),e.isArray(i))r=n.observableArray(i),o(i,r),l=!0;else if("function"==typeof i){if(!n.isObservable(i))return null;r=i}else e.isPromise(i)?(r=n.observable(),i.then(function(t){if(e.isArray(t)){var a=n.observableArray(t);o(t,a),t=a}r(t)})):(r=n.observable(i),s(i));return Object.defineProperty(t,a,{configurable:!0,enumerable:!0,get:r,set:n.isWriteableObservable(r)?function(t){t&&e.isPromise(t)?t.then(function(t){c(r,t,e.isArray(t))}):c(r,t,l)}:void 0}),u[a]=r,r}function u(t,a,i){var r,o={owner:t,deferEvaluation:!0};return"function"==typeof i?o.read=i:("value"in i&&e.error('For defineProperty, you must not specify a "value" for the property. You must provide a "get" function.'),"function"!=typeof i.get&&e.error('For defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".'),o.read=i.get,o.write=i.set),r=n.computed(o),t[a]=r,l(t,a,r)}var d,f=Object.prototype.toString,v=["[object Function]","[object String]","[object Boolean]","[object Number]","[object Date]","[object RegExp]"],g=["remove","removeAll","destroy","destroyAll","replace"],p=["pop","reverse","sort","shift","splice"],h=["push","unshift"],m=Array.prototype,b=n.observableArray.fn,y=!1;return d=function(e,t){var a,i,r;return e?(a=e.__observable__,a&&(i=a[t])?i:(r=e[t],n.isObservable(r)?r:l(e,t,r))):null},d.defineProperty=u,d.convertProperty=l,d.convertObject=s,d.install=function(e){var n=t.binding;t.binding=function(e,t,a){a.applyBindings&&!a.skipConversion&&s(e),n(e,t)},y=e.logConversion},d});